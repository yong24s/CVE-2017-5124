FROM ubuntu:17.10

# Setup SSHD
# https://docs.docker.com/engine/examples/running_ssh_service/#build-an-eg_sshd-image

RUN apt-get update && apt-get install -y openssh-server
RUN mkdir /var/run/sshd
RUN useradd -m user -s /bin/bash 
RUN echo 'user:user' | chpasswd
RUN echo 'root:toor' | chpasswd
RUN sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN sed -i 's/X11UseLocalhost yes/X11UseLocalhost no/' /etc/ssh/sshd_config

# SSH login fix. Otherwise user is kicked off after login
RUN sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd

ENV NOTVISIBLE "in users profile"
RUN echo "export VISIBLE=now" >> /etc/profile

RUN apt-get -y install xauth


# APT MAY BREAK

ADD ./install /install

RUN apt-get -y install chromium-browser

RUN apt-get install -y gconf-service libasound2 libatk1.0-0 libcairo2 libcups2 libfontconfig1 libgdk-pixbuf2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libxss1 fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils

RUN dpkg --ignore-depends=chromium-codecs-ffmpeg-extra -i /install/chromium-browser_61.0.3163.100-0ubuntu1.1378_amd64.deb

# RUN apt-mark hold chromium-browser
# RUN apt install -f

EXPOSE 22
CMD ["/usr/sbin/sshd", "-D"]

